
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>雨辰不语</title>
  <meta name="author" content="suzhen">

  
  <meta name="description" content="hash是我们经常会用到一种数据结构。它有很多特别的有趣的特性是不被发现的。这片文章来总结一下： Hash.new 初始化一个HASH对象。 ah1 = {} #=> {} ah2 = Hash.new #=> {} 以上两种是最基本的初始化方法。 ah3 = Hash.new(&#8220; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://suzhen.github.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="雨辰不语" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">雨辰不语</a></h1>
  
    <h2>记录学习中的点点滴滴</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:suzhen.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/06/shen-qi-de-hash/">神奇的HASH</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-06T16:09:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>hash是我们经常会用到一种数据结构。它有很多特别的有趣的特性是不被发现的。这片文章来总结一下：</p>

<p>  Hash.new 初始化一个HASH对象。</p>

<p>  ah1 = {}     #=>  {}</p>

<p>  ah2 = Hash.new  #=> {}</p>

<p>  以上两种是最基本的初始化方法。</p>

<p>  ah3 = Hash.new(&#8220;hello&#8221;)   #=>{}</p>

<p>  ah4 = Hash.new {|hash,key| hash[key] = &#8220;hello,#{key}&#8221;} #=>{}</p>

<p>  以上两种初始化方法，是给hash对象没有value的key一个默认的value。</p>

<p>  一： ah3[&#8220;age&#8221;] 我们并没有赋值，ah3也没有这个key</p>

<p>  但我们输出 ah3[“age&#8221;] 时，会出现 hello  ，无论我们使用什么key,只要没有赋值，输出的都是hello</p>

<p>  二：ah4就更神奇了，输出的默认value，是和我们的key有了关系。比如：</p>

<p>  ah4[“suzhen”] => hello,suzhen</p>

<p>  ah4[“suyuchen”] => hello,suyuchen</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/06/rubymo-fa-shi-tao-xin-pian/">RUBY魔法师(掏心篇)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-06T16:06:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ruby也有一些黑魔法，用的好，可以事半功倍，但是也存在着很大的风险。今天要讲的是打破一层一层的封装，跳过常规的读写方式，直接从object里获取或者设置instanc variable 的方法。</p>

<p>  首先我们可以先了解 实例对象 ，类的实例对象， 类对象 三个概念。</p>

<p>  施展两组黑魔法。</p>

<p>   instance_variable_get 与  instance_variable_set</p>

<p>   直接对一个对象或者类里面，获取和设置某个实例对象。注意在 获取和设置obj的实例对象的时候，要先确保obj的实例对象已经产生了。</p>

<p>  class_variable_get 与 class_variable_set</p>

<p>  直接对一个类，获取和设置类对象。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">G</span>
</span><span class='line'>    <span class="vc">@@class_variable</span> <span class="o">=</span> <span class="mi">33</span>
</span><span class='line'>    <span class="vi">@class_instance_variable</span> <span class="o">=</span> <span class="mi">55</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="vi">@instance_variable_1</span> <span class="o">||=</span> <span class="mi">44</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">build_var2</span>
</span><span class='line'>      <span class="vi">@instance_variable_2</span> <span class="o">=</span> <span class="mi">22</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">g</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span class='line'>  <span class="n">g</span><span class="o">.</span><span class="n">build_var2</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span>  <span class="n">g</span><span class="o">.</span><span class="n">instance_variable_get</span><span class="p">(</span><span class="s2">&quot;@instance_variable_1&quot;</span><span class="p">)</span> <span class="c1">#=&gt; 44</span>
</span><span class='line'>  <span class="nb">p</span> <span class="n">G</span><span class="o">.</span><span class="n">class_variable_get</span><span class="p">(</span><span class="ss">:@@class_variable</span><span class="p">)</span>  <span class="c1">#=&gt; 33</span>
</span><span class='line'>  <span class="nb">p</span> <span class="n">G</span><span class="o">.</span><span class="n">instance_variable_get</span><span class="p">(</span><span class="ss">:@class_instance_variable</span><span class="p">)</span>  <span class="c1">#=&gt; 55</span>
</span></code></pre></td></tr></table></div></figure>


<p>  注意这两组黑魔法的argument可以有种形式，一种是string，一种是sym。string就意味着可以拼接一个参数。</p>

<p>  这两组黑魔法，都是打破了OO的封闭。这样的好处是很直接就可以操作一个对象的核心的变量，如果这些变量并没有提供对外存取的method。但要注意到普通对象的实例变量是惰性的，不会在定义中就生成，只能在运行中产生实例变量。</p>

<p>  那我们想知道运行中对象都产生了哪些实例对象呢?</p>

<p>  p g.instance_variables  #=>[:@instance_variable_1,:@instance_variable_2]</p>

<p>  或者都我们在存取实例对象的时候，先判断一下这个instance variable是否已经生成。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>   <span class="n">g</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span class='line'>   <span class="nb">p</span> <span class="n">g</span><span class="o">.</span><span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@instance_variable_1</span><span class="p">)</span> <span class="c1">#=&gt; true</span>
</span><span class='line'>   <span class="nb">p</span> <span class="n">g</span><span class="o">.</span><span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@instance_variable_2</span><span class="p">)</span> <span class="c1">#=&gt; false</span>
</span><span class='line'>   <span class="n">g</span><span class="o">.</span><span class="n">build_var2</span>
</span><span class='line'>   <span class="nb">p</span> <span class="n">g</span><span class="o">.</span><span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@instance_variable_2</span><span class="p">)</span> <span class="c1">#=&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>   魔法使用场景： 我们发现以上说的黑魔法都是public的,。那么instance_variable_get/set同样可以在类内部使用。但是instance_variable在method之间是可以自由获取和设置的。为什么还会用的到instance_variable_get/set呢?</p>

<p>  看如下的例子：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Volume</span>
</span><span class='line'>    <span class="no">ATTRIBUTES</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>      <span class="ss">:name</span><span class="p">,</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">:type</span><span class="p">,</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">:date_created</span><span class="p">,</span> <span class="ss">:date_modified</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:iscsi_target</span><span class="p">,</span> <span class="ss">:iscsi_portal</span>
</span><span class='line'>    <span class="o">].</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="kp">attr</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">SYSTEM</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="no">DATA</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">SYSTEM</span>
</span><span class='line'>    <span class="p">}</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">args</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># EDIT</span>
</span><span class='line'>      <span class="c1"># args = args ? DEFAULTS : DEFAULTS.merge(args) # Original</span>
</span><span class='line'>      <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="p">?</span> <span class="no">DEFAULTS</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">:</span> <span class="no">DEFAULTS</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">key?</span><span class="p">(</span><span class="kp">attr</span><span class="p">))</span>
</span><span class='line'>            <span class="nb">instance_variable_set</span><span class="p">(</span><span class="s2">&quot;@</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="kp">attr</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="err">＃</span><span class="nb">instance_variable_set</span><span class="err">的</span><span class="n">argument</span><span class="err">是可以用</span><span class="n">string</span><span class="err">拼接的，就有了很大的灵活性。这样也就行成了元编程。否则就要</span><span class="vi">@name</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">;</span><span class="vi">@size</span><span class="o">=</span><span class="n">args</span><span class="o">[</span><span class="ss">:size</span><span class="o">]</span><span class="err">…</span> <span class="err">我们也可以用</span><span class="nb">__send__</span><span class="err">方法来解决。</span>
</span><span class='line'>          <span class="c1"># self.__send__ &quot;#{attr}=&quot;,args[attr]</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">inspect</span>
</span><span class='line'>      <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">inject</span><span class="p">({</span> <span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>        <span class="n">h</span><span class="o">[</span><span class="kp">attr</span><span class="o">]</span> <span class="o">=</span> <span class="nb">instance_variable_get</span><span class="p">(</span><span class="s2">&quot;@</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">h</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">to_json</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">inspect</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  在类的内也有针对instance variable的操作。</p>

<p>  移除实例变量的方法：remove_instance_variable 这个方法是private</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="kp">attr_reader</span> <span class="ss">:var</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="vi">@var</span> <span class="o">=</span> <span class="mi">99</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">remove</span>
</span><span class='line'>      <span class="n">remove_instance_variable</span><span class="p">(</span><span class="ss">:@var</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">d</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">d</span><span class="o">.</span><span class="n">var</span>      <span class="c1">#=&gt; 99</span>
</span><span class='line'>  <span class="n">d</span><span class="o">.</span><span class="n">remove</span>   <span class="c1">#=&gt; 99</span>
</span><span class='line'>  <span class="n">d</span><span class="o">.</span><span class="n">var</span>      <span class="c1">#=&gt; nil</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/06/rubydong-tai-diao-yong-fang-fa/">RUBY动态调用方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-06T16:03:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>有三种方式：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:host</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@host</span> <span class="o">=</span> <span class="nb">name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Hi,</span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  第一种用send动态调用</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;suzhen&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:say</span><span class="p">,</span><span class="s2">&quot;how are you&quot;</span><span class="p">)</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>  第二种用method来获取某个方法，用call来调用。也算是延迟调用。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">m</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;suzhen&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="ss">:say</span><span class="p">)</span>
</span><span class='line'>  <span class="n">m</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;how are you&quot;</span><span class="p">)</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>  第三种用eval来动态调用</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="nb">eval</span> <span class="s2">&quot;Dummy.new(&#39;suzhen&#39;).say(&#39;how are you&#39;)&quot;</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/06/javascriptgao-jie-zhi-arguments/">Javascript高阶之arguments</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-06T15:53:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>arguments对象是所有function中可用的局部变量，它像是一个array,但并不是一个array（这一点下面会详细说明）。</p>

<p>在一个function内部，可以通过使用arguments对象来访问当前function的参数。这个类似于数组的对象包含了每个传入function的参数。index也是从0开始的。如果一个function被传入了三个参数，可以这么访问它们：</p>

<p>arguments[0]
arguments[1]
arguments[2]</p>

<p>当然这些参数也能被生置：</p>

<p>arguments[1] = &#8220;new value&#8221;</p>

<p>现在说说这个类似于array，但又不是array的arguments对象。它除了能像array一样通过index访问，还有一个length的属性，再没有像array的那些方法和属性了,比如pop方法或者push方法了。</p>

<p>但是我们又常常需要arguments对象具有array的这些方法，怎么办？其实它能被转化成一个真的array.</p>

<p>var args = Array.prototype.slice.call(arguments);</p>

<p>//问题：为什么是Array.prototype.slice，而不是Array.slice？
//回复：一个是实例方法，一个是类方法。</p>

<p>这样arguments就全部转化为了args数组，就可以对这个array实例用各种实例方法。</p>

<p>比如：我们传入的参数，前面n个是参数，而最后一个是callback函数。</p>

<p>如果获取这最后一个function的参数呢？</p>

<p>fn_callback = args.pop()</p>

<p>这样就可以获取到callback函数。</p>

<p>另外一种方法：</p>

<p>  var args = []</p>

<p>  args = Array.apply(args,arguments)</p>

<p> Array是一个类，那么Array也就是一个类的构造函数。</p>

<p>在call中，arguments是做为this，而在apply中，arguments是做为参数。关于apply和call在以后会有详细说明。</p>

<p>如果我们需要调用一个function时，并不确定要传入多少参数。那么在定义这个function的时候，就没必要再写任何形参了。</p>

<p>function f1(){</p>

<p>}</p>

<p>f1(&#8220;cat&#8221;,&#8221;dog&#8221;,&#8221;cow&#8221;,&#8221;snake&#8221;)</p>

<p>或者我们只需要一个参数，但传入了多个参数。</p>

<p>function f1(animal){</p>

<p>}
f1(&#8220;cat&#8221;,&#8221;dog&#8221;,&#8221;cow&#8221;,&#8221;snake&#8221;)</p>

<p>这时候，用arguments对象就非常有用了。</p>

<p>可以用arguments.length来判断传入参数的个数。也可以用arguments处理每个参数。</p>

<p>有一个小技巧可以利用：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">myConcat</span><span class="p">(</span><span class="nx">separator</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">separator</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">You</span> <span class="nx">can</span> <span class="nx">pass</span> <span class="nx">any</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">arguments</span> <span class="nx">to</span> <span class="k">this</span> <span class="kd">function</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">it</span> <span class="nx">creates</span> <span class="nx">a</span> <span class="nx">list</span> <span class="nx">using</span> <span class="nx">each</span> <span class="nx">argument</span> <span class="nx">as</span> <span class="nx">an</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">list</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// returns &quot;red, orange, blue&quot;</span>
</span><span class='line'><span class="nx">myConcat</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// returns &quot;elephant; giraffe; lion; cheetah&quot;</span>
</span><span class='line'><span class="nx">myConcat</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">,</span> <span class="s2">&quot;elephant&quot;</span><span class="p">,</span> <span class="s2">&quot;giraffe&quot;</span><span class="p">,</span> <span class="s2">&quot;lion&quot;</span><span class="p">,</span> <span class="s2">&quot;cheetah&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// returns &quot;sage. basil. oregano. pepper. parsley&quot;</span>
</span><span class='line'><span class="nx">myConcat</span><span class="p">(</span><span class="s2">&quot;. &quot;</span><span class="p">,</span> <span class="s2">&quot;sage&quot;</span><span class="p">,</span> <span class="s2">&quot;basil&quot;</span><span class="p">,</span> <span class="s2">&quot;oregano&quot;</span><span class="p">,</span> <span class="s2">&quot;pepper&quot;</span><span class="p">,</span> <span class="s2">&quot;parsley&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>myConcat只有一个参数，这个参数是用来传入连接之后每一个参数的字符的。这种参数就需要特定的形参来固定下来，如果只是枚举的参数，就不需要形参，在调用的时候，直接转入去就可以了。通过arguments对象可以获取到。</p>

<p>arguments对象除了length属性，还有一个callee属性</p>

<p>arguments.callee 获取当前执行的function，递归的时候会有用。但会有一个疑问，用方法名不就可以吗? 但是有匿名方法的时候，这个有用了。而且，如果function内部重复用方法名，要是想改方法名就需要改多个地方。容易出错。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">n</span> <span class="o">*</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">create</span><span class="p">()(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// returns 120 (5 * 4 * 3 * 2 * 1)</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/06/activemodelyu-activerecrodde-xuan-ze/">ActiveModel与ActiveRecrod的选择</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-06T15:41:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>如果我们有一个类，继承了ActiveRecord::Base，那么意味着这是一个用来做model的类。它具有了把数据存入数据库的能力。除此之外还拥有了关于验证（Validations）的类方法，关于转化（Conversion）的实例方法，关于命名（Naming）的类方法等等。
  但其实，除了把数据存入数据库的能力，是ActiveRcord提供的。其它的功能都是ActiveModel完成的。只是ActiveRecord有了对ActiveModel的依赖。
  换句话说，如果我们不准备把数据存入库，但还是希望这个类，像个model一样的工作。那么直接混入ActiveModel就可以了。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span><span class="ss">:age</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  那么Person的对象不再有save,update,Person类也不再有all,find,where等与数据保存，修改，查询，删除等一切方法。
  但具有了以下方法：</p>

<ol>
<li>to_model, to_key, to_param, persisted?</li>
<li>model_name 以及 model_name.human, model_name.partial_path, model_name.singular, model_name.plural</li>
<li>valid?, errors 以及 errors[], errors.full_messages</li>
</ol>


<p>  但Person依然能像一般model类一样，实例化一个对象。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="o">=&gt;</span> <span class="s2">&quot;suzhen&quot;</span><span class="p">,</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="mi">18</span><span class="p">)</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>  但遗憾的是这种用法只能在rails4.0及以上使用。rails3的版本只能分别引入ActiveModel的各module.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span><span class="ss">:age</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span> <span class="c1">#混入验证功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Conversion</span> <span class="err">＃混入转化功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">extend</span>  <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Naming</span> <span class="err">＃混入命名功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">…</span> <span class="err">…</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="o">=&gt;</span> <span class="s2">&quot;suzhen&quot;</span><span class="p">,</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="mi">18</span><span class="p">)</span> <span class="err">＃这样会报错</span> <span class="no">ArgumentError</span><span class="p">:</span> <span class="n">wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">arguments</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  如果想像model那样的可以把参数传入就需要，重写initialize即可：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="c1">#元编程再次发威</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  完整code如下：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span><span class="ss">:age</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span> <span class="c1">#混入验证功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Conversion</span> <span class="c1">#混入转化功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">extend</span>  <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Naming</span> <span class="c1">#混入命名功能</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>          <span class="n">attributes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>              <span class="nb">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="k">if</span> <span class="nb">respond_to?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="o">=&gt;</span> <span class="s2">&quot;suzhen&quot;</span><span class="p">,</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="mi">18</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">18</span>
</span><span class='line'>  <span class="nb">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/rubymo-fa-shi-%28fang-fa-gao-ji-pian-%29/">RUBY魔法师（方法高级篇）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T11:37:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  一、动态创建method和动态调用方法</p>

<p>  问题：什么是动态创建和动态调用方法？
  答：就是代码在运行过程时，才定义的方法。同样，只有在代码运行时，才能开始调用的方法，是动态调用方法，这是一组很有用的魔法。</p>

<p>  魔法师用define_method来动态创建实例方法：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="c1">#动态创建一个实例方法say_hi</span>
</span><span class='line'>    <span class="n">define_method</span> <span class="ss">:say_hi</span> <span class="k">do</span> <span class="o">|</span> <span class="nb">name</span> <span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;HI,</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="c1">#动态创建一个类方法say_hello</span>
</span><span class='line'>    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>      <span class="n">define_method</span> <span class="ss">:say_hello</span> <span class="k">do</span> <span class="o">|</span> <span class="nb">name</span> <span class="o">|</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;Hello,</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say_hi</span><span class="p">(</span><span class="s2">&quot;suzhen&quot;</span><span class="p">)</span> <span class="c1">#-&gt;  HI,suzhen</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hello</span><span class="p">(</span><span class="s2">&quot;suzhen&quot;</span><span class="p">)</span> <span class="c1">#-&gt; Hello,suzhen</span>
</span></code></pre></td></tr></table></div></figure>


<p>  创建单例方法：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">obj</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">obj2</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span>
</span><span class='line'>        <span class="n">define_method</span> <span class="ss">:say_hi</span> <span class="k">do</span>
</span><span class='line'>          <span class="nb">puts</span> <span class="s2">&quot;HI&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>   <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">obj</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#-&gt;HI</span>
</span><span class='line'>   <span class="n">obj</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#-&gt; mt_ad.rb:30:in `&lt;main&gt;&#39;: undefined method `say_hi&#39; for #&lt;Dummy:0x007fce6c109068&gt; (NoMethodError)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  说明：</p>

<p>  1、define_method是一个private方法</p>

<p>  2、由于define_method是一个private方法，它不能被显式调用。</p>

<p>  3、define_method是Module类的一个instance_method,只能由一个具体的module和一个具体的class来调用。</p>

<pre><code>因为:
</code></pre>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">DummyModule</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">DummyModule</span><span class="o">.</span><span class="n">class</span> <span class="c1">#—&gt;Module</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">class</span> <span class="c1">#—&gt;Class</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span> <span class="c1">#—&gt;Module</span>
</span></code></pre></td></tr></table></div></figure>


<p>  一个具体的module或者一个具体的class都是Module类的实例。</p>

<p>  4、为当前self(必须是类，不管是普通类还是eigenclass)创建一个instance method,换句话说就是define_method消息的接收者只能是类对象。</p>

<p>  比如：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1">#当前self是Dummy类本身，所以此处定义的是Dummy的实例方法。</span>
</span><span class='line'>    <span class="n">define_method</span> <span class="ss">:say_hello</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;hello,suzhen&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_method</span>
</span><span class='line'>      <span class="c1">#类方法中的self，代表的也是Dummy类本身，所以此处定义的是Dummy的实例方法。</span>
</span><span class='line'>      <span class="n">define_method</span> <span class="ss">:say_hi</span> <span class="k">do</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say_hello</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">create_method</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say_hi</span>
</span><span class='line'>
</span><span class='line'>  <span class="err">————————————————————</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="no">Dummy</span>
</span><span class='line'>    <span class="c1">#此处的self是Dummy的eigenclass，所以就是创建eigenclass类的实例方法，也就是Dummy的类方法。</span>
</span><span class='line'>    <span class="n">define_method</span> <span class="ss">:say_bye</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;bye&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_bye</span>
</span></code></pre></td></tr></table></div></figure>


<p>  或者：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_class_method</span>
</span><span class='line'>      <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>         <span class="n">define_method</span> <span class="ss">:say_love</span> <span class="k">do</span>
</span><span class='line'>          <span class="nb">puts</span> <span class="s2">&quot;love&quot;</span>
</span><span class='line'>         <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">create_class_method</span>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_love</span> <span class="c1">#—&gt; love</span>
</span><span class='line'>
</span><span class='line'>  <span class="err">————————————————————</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">define_new_method_by_other_method</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">#注意这里的self代表的是Dummy的实例对象。并不是类对象，所以是没有define_method方法的。</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">define_method</span> <span class="ss">:say_hi</span> <span class="k">do</span> <span class="o">|</span> <span class="nb">name</span> <span class="o">|</span>
</span><span class='line'>          <span class="nb">puts</span> <span class="s2">&quot;HI,</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">define_new_method_by_other_method</span> <span class="c1">#报错</span>
</span></code></pre></td></tr></table></div></figure>


<p>  综上所述可以看出，我们在使用define_method方法都是在当前类的内部。而作为private方法是不可以在外面调用的，比如：</p>

<p>  Dummy.define_method :say_hi do end # 访问保护</p>

<p>  或者</p>

<p>  obj = Dummy.new</p>

<p>  obj.class.define_method :say_hi do end＃访问保护</p>

<p>  但魔法师当然有他的魔术：send</p>

<p>  send 不仅可以动态调用方法，还可以调用私有方法。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="nb">proc</span> <span class="o">=</span> <span class="nb">lambda</span><span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;suzhen&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">send</span> <span class="ss">:define_method</span><span class="p">,</span><span class="ss">:say_hi</span><span class="p">,</span><span class="o">&amp;</span><span class="nb">proc</span>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say_hi</span>
</span></code></pre></td></tr></table></div></figure>


<p>  或者</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">send</span> <span class="ss">:define_method</span><span class="p">,</span><span class="ss">:say_hi</span><span class="p">,</span><span class="o">&amp;</span><span class="nb">proc</span>
</span></code></pre></td></tr></table></div></figure>


<p>  给obj的eigenclass动态定义方法</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">singleton_class</span><span class="o">.</span><span class="n">send</span>  <span class="ss">:define_method</span><span class="p">,</span><span class="ss">:say_hi</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span>  <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#suzhen</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj2</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#报错</span>
</span></code></pre></td></tr></table></div></figure>


<p>  在类的外部动态创建类的类方法</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">singleton_class</span><span class="o">.</span><span class="n">send</span>  <span class="ss">:define_method</span><span class="p">,</span><span class="ss">:say_hi</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span>  <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#—&gt; suzhen</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>  我们发现从外面给一个实例对象动态创建方法，或者给一个类动态创建方法，都需要先获取他们的eigenclass，再通过send 动态调用define_method方法，把要动态创建的方法名和block做为参数再传入。</p>

<p>  这样太麻烦了。有没有简单点的方法呢？魔法师给了我们一个魔法：define_singleton_method 它是Object类的一个实例方法。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">obj</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">obj2</span> <span class="o">=</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">define_singleton_method</span> <span class="ss">:say_hi</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#-&gt; suzhen</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj2</span><span class="o">.</span><span class="n">say_hi</span> <span class="c1">#-&gt;报错</span>
</span></code></pre></td></tr></table></div></figure>


<p>  或者</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">define_singleton_method</span> <span class="ss">:say_hello</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;hello&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hello</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">define_singleton_method</span> <span class="err">为我们的工作减少不小的工作量：</span>
</span></code></pre></td></tr></table></div></figure>


<p>  1，减少获取eigenclass的过程： (class &lt;&lt; obj ;self; end) ｜ (class &lt;&lt; Dummy ;self; end) 或者obj.singeton_class | Dummy.singenton_class</p>

<p>  2，减少了eigenclass使用send动态调用define_method的过程:   (eigenClass).send :define_method,agru,&amp;block</p>

<p>  下一个要考虑的问题就是：</p>

<p>  设置动态创建的method的权限。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">singleton_class</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>      <span class="kp">private</span>  <span class="ss">:say_hi</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="err">或者：</span>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">singleton_class</span><span class="o">.</span><span class="n">send</span> <span class="ss">:private</span><span class="p">,</span><span class="ss">:say_hi</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">obj</span><span class="o">.</span><span class="n">say_hi</span> <span class="err">＃报错</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">singleton_class</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>      <span class="kp">private</span> <span class="ss">:say_hello</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hello</span> <span class="c1">#报错</span>
</span></code></pre></td></tr></table></div></figure>


<p>  我们来复习一下上面的内容发现：defind_methd 可以在一个普通类里动态定义方法，也可以在eigenClass里动态定义方法。可以在一个类内部动态定义方法，也可以在一个类外部通过send进行动态方法的定义。</p>

<p>  以上说的是method的动态定义，动态执行。  那么根据增删查改的模式，我还要了解 “删”，“查”，“改”（重载或者）</p>

<p>  那么如何删除一个方法？</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="n">undef_method</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">remove_method</span>  <span class="err">相应的</span><span class="n">callback</span> <span class="n">method_removed</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Parent</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">hello</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;In parent&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Child</span> <span class="o">&lt;</span> <span class="no">Parent</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">hello</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;In child&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">c</span> <span class="o">=</span> <span class="no">Child</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">c</span><span class="o">.</span><span class="n">hello</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Child</span>
</span><span class='line'>     <span class="n">remove_method</span> <span class="ss">:hello</span>  <span class="c1"># remove from child, still in parent</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">c</span><span class="o">.</span><span class="n">hello</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Child</span>
</span><span class='line'>      <span class="n">undef_method</span> <span class="ss">:hello</span>   <span class="c1"># prevent any calls to &#39;hello&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">c</span><span class="o">.</span><span class="n">hello</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">In</span> <span class="n">child</span>
</span><span class='line'>  <span class="no">In</span> <span class="n">parent</span>
</span><span class='line'>  <span class="n">prog</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`hello&#39; for #&lt;Child:0x401b3bb4&gt; (NoMethodError)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  undef_method与remove_method的用法与define_method是一样的。区别在于，remove_method 只是移除了本类中的方法，但父类的方法还在。对象还是可以调用该方法的。但undef_method就彻底把方法从家族中移除了。</p>

<p>  如何查看有哪些方法呢？</p>

<p>  methods;
  instance_methods;
  private_instance_methods;protected_instance_methods;public_instance_methods;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/rubyzhi-lei-dui-xiang/">Ruby之类对象</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T11:26:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>先熟悉一下类对象。</p>

<p>  它有点像是作用在整个类继承层次的 全局变量, 它的行为像是没有命名空间的全局常量, 在 一个类及其所有子类中 总是唯一的. 既然他属于 类和它的子孙 公用的那一部分, 那也必然应该属于类了, @@类变量是私有的, 只能在类定义内部隐式的访问它.</p>

<p>  @@对象不仅被类族中类方法访问，也可以被类族中的实例对象访问到。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="vc">@@name</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">name</span>
</span><span class='line'>      <span class="vc">@@name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>      <span class="vc">@@name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">name</span>    <span class="c1"># suzhen</span>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">name</span>  <span class="c1">#suzhen</span>
</span></code></pre></td></tr></table></div></figure>


<p>  active_support中对这种类对象有很好的封装。看下面代码：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="nb">require</span> <span class="s2">&quot;active_support/all&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="n">mattr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">name</span> <span class="c1">#suzhen</span>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">name</span>  <span class="c1">#suzhen</span>
</span></code></pre></td></tr></table></div></figure>


<p>  mattr_accessor 就是帮我们创建了一组类方法和一组实例方法</p>

<p>  有的时候，我们只想给出类方法的访问，而不想给出实例方法的访问。</p>

<p>  mattr_accessor :name,:instance_accessor=>false</p>

<p>  至于mattr_accessor 是如何实现的，可以看rails的代码。</p>

<p>  https://github.com/rails/rails/blob/master/activesupport/lib/active_support/core_ext/module/attribute_accessors.rb</p>

<p>  mattr_accessor 与 cattr_accessor 是一样的。</p>

<p>  我们看下面的例子：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">SomeModule</span>
</span><span class='line'>    <span class="vc">@@logger</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">SomeModule</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">say</span>
</span><span class='line'>      <span class="vc">@@logger</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">say</span>
</span><span class='line'>      <span class="vc">@@logger</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">say</span>   <span class="err">＃</span><span class="n">suzhen</span>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">say</span> <span class="c1">#suzhen</span>
</span></code></pre></td></tr></table></div></figure>


<p>  当一个class引入一个module就是这个class就继承了这个module,那么module中定义的类变量，就可以在这上类家庭中使用了。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">SomeModule</span>
</span><span class='line'>    <span class="n">mattr_accessor</span> <span class="ss">:logger</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">include</span> <span class="no">SomeModule</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">logger</span>  <span class="err">＃</span><span class="n">suzhen</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="no">Dummy</span><span class="o">.</span><span class="n">logger</span>  <span class="c1">#error</span>
</span></code></pre></td></tr></table></div></figure>


<p>  但是上面这个例子中，mattr_accessor 把类方法 self.logger 和self.logger=定义在了module中，include自然不会引用这种类方法。但实例方法是可以用的。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">SomeMoudle</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>      <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">mattr_accessor</span> <span class="ss">:logger</span>
</span><span class='line'>        <span class="nb">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span>   <span class="c1">#初始化的时候一定把self加上。显示的调用。</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  用以上这种方法自然可以解决这个问题。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/rubymo-fa-shi-fang-wen-kong-zhi/">Ruby魔法师(访问控制)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T11:20:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一个class中的method有三种访问权限，public , protected, private</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Car</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car running&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pro_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car booting&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pri_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;engine start&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span><span class="o">.</span><span class="n">pub_method</span> <span class="c1">#输出 Car running</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span><span class="o">.</span><span class="n">pro_method</span> <span class="c1">#报错 protected method不可以被调用</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span><span class="o">.</span><span class="n">pri_method</span> <span class="c1"># 报错 private method不可以调用</span>
</span></code></pre></td></tr></table></div></figure>


<p>  从以上例子可以看出 class 里的instance_method默认是public的,object的protected和private的method是不可以在外部直接调用的。只能在instance_method内部调用。</p>

<p>  这里特别要注意的是：</p>

<p>  在method调用 里有 显示调用 和 隐藏调用 两种方式，例如:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Car</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#self隐藏调用</span>
</span><span class='line'>      <span class="n">pro_method</span>
</span><span class='line'>      <span class="n">pri_method</span>
</span><span class='line'>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car running&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pro_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car booting&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pri_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;engine start&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span><span class="o">.</span><span class="n">pub_method</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#输出 engine start</span>
</span><span class='line'>      <span class="no">Car</span> <span class="n">booting</span>
</span><span class='line'>      <span class="no">Car</span> <span class="n">running</span>
</span></code></pre></td></tr></table></div></figure>


<p>  !!! *** pro_method和pri_method都支持隐藏调，但是只有protected支持显示调用，private不支持显示调用。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Car</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#self显示调用</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">pro_method</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">pri_method</span>
</span><span class='line'>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car running&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pro_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;Car booting&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pri_method</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;engine start&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">car</span><span class="o">.</span><span class="n">pub_method</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">pri_method</span> <span class="c1">#是会报错的，而self.pro_method是可以通过的。</span>
</span></code></pre></td></tr></table></div></figure>


<p>  显示或者隐藏调用的对象不仅仅是指self，还有同类别的对象（包括同类的对象和子类的对象）。</p>

<p>  例子如下：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">C</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>         <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>      <span class="c1">#c是同类别的对象 （神奇的魔法）</span>
</span><span class='line'>          <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="vi">@name</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="kp">protected</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>          <span class="vi">@name</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="n">C</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">d1</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;fankai&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">d2</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">d1</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  这个例子，即保证不能让客户端读取到对象的名称，又能在类内部可以获取到实例变量。</p>

<p>  接着我们可以看一个ruby类的继承关系。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">A</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method</span>
</span><span class='line'>      <span class="n">method1</span>
</span><span class='line'>      <span class="n">method2</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">method1</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;hello&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">method2</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;world&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="n">A</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method2</span>
</span><span class='line'>      <span class="n">method1</span>
</span><span class='line'>      <span class="n">method2</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="n">B</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pub_method3</span>
</span><span class='line'>      <span class="n">method1</span>
</span><span class='line'>      <span class="n">method2</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">A</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">pub_method</span> <span class="c1"># 输出 hello world</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">B</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">pub_method2</span> <span class="c1"># 输出 hello world</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">C</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">pub_method3</span> <span class="c1"># 输出 hello world</span>
</span></code></pre></td></tr></table></div></figure>


<p>  由些可见，ruby在继承关系中public 和 protected 和 private都是一样，全部可以被继承。</p>

<p>  通过我们会认为类的方法是没有private和protected之分的，我们来看以下的例子：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>      <span class="kp">private</span>
</span><span class='line'>      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">say_hi</span>
</span><span class='line'>         <span class="nb">puts</span> <span class="s2">&quot;hi&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hi</span>  <span class="c1">#-&gt; hi    说明private对类方法是没有的。</span>
</span></code></pre></td></tr></table></div></figure>


<p>  但是魔法师没有什么是做不到的，如果你想要，类方法有可以有这种调用限制。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>          <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>              <span class="kp">protected</span>
</span><span class='line'>              <span class="k">def</span> <span class="nf">say_hello</span>
</span><span class='line'>                <span class="nb">puts</span> <span class="s2">&quot;hello&quot;</span>
</span><span class='line'>              <span class="k">end</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">Dummy</span><span class="o">.</span><span class="n">say_hello</span> <span class="c1">#in `&lt;main&gt;&#39;: protected method `say_hello&#39; called for Dummy:Class (NoMethodError)</span>
</span></code></pre></td></tr></table></div></figure>


<p>  看了上面的例子你来会认为类的方法是没有private和protected之分的吗？？？</p>

<p>  我想说ruby,你他妈的太牛逼了！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/rubymo-fa-shi-chu-shi-hua-dui-xiang/">RUBY魔法师(初始化对象)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T11:00:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  我们会创建一个class。通过这个class去new出一个又一个对象。这个类里有许多的对象实例变量，有的是需要new的时候去设置的。有的对象实例变量有一些默认值。我们该怎么去设计一个好的类呢。</p>

<p>  最普通的设计方法：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Volume</span>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">:type</span><span class="p">,</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">:date_created</span><span class="p">,</span> <span class="ss">:date_modified</span><span class="p">,</span> <span class="ss">:iscsi_target</span><span class="p">,</span> <span class="ss">:iscsi_portal</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">SYSTEM</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="no">DATA</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">{})</span>
</span><span class='line'>        <span class="vi">@name</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@size</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:size</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@type</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:type</span><span class="o">].</span><span class="n">nil?</span> <span class="p">?</span> <span class="no">SYSTEM</span> <span class="p">:</span>  <span class="n">args</span><span class="o">[</span><span class="ss">:type</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@owner</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:owner</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@iscsi_target</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:iscsi_target</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@iscsi_portal</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:iscsi_portal</span><span class="o">]</span>
</span><span class='line'>        <span class="vi">@date_created</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@date_modified</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">inspect</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="vi">@name</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:size</span> <span class="o">=&gt;</span> <span class="vi">@size</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="vi">@type</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:owner</span> <span class="o">=&gt;</span> <span class="vi">@owner</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:date_created</span> <span class="o">=&gt;</span> <span class="vi">@date_created</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:date_modified</span> <span class="o">=&gt;</span> <span class="vi">@date_modified</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:iscsi_target</span> <span class="o">=&gt;</span> <span class="vi">@iscsi_target</span><span class="p">,</span>
</span><span class='line'>                <span class="ss">:iscsi_portal</span> <span class="o">=&gt;</span> <span class="vi">@iscsi_portal</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">to_json</span>
</span><span class='line'>        <span class="nb">self</span><span class="o">.</span><span class="n">inspect</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  要求：init的时候，可以传入配置项，也可以什么都不传。但无论传不传argument都要保证有@type的实例变量是有值的。</p>

<p>  我们要对这个类进行重构。</p>

<p>  用rspec 去保证重构的正确性。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="nb">require</span> <span class="s2">&quot;./init&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;Object Init&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;all arguments are existing&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
</span><span class='line'>        <span class="vi">@v</span> <span class="o">=</span> <span class="no">Volume</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:name</span><span class="o">=&gt;</span><span class="s1">&#39;suzhen&#39;</span><span class="p">,</span><span class="ss">:size</span><span class="o">=&gt;</span><span class="s2">&quot;300&quot;</span><span class="p">,</span><span class="ss">:owner</span><span class="o">=&gt;</span><span class="s2">&quot;sue&quot;</span><span class="p">,</span><span class="ss">:iscsi_target</span><span class="o">=&gt;</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="ss">:iscsi_portal</span><span class="o">=&gt;</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="ss">:type</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">})</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object name should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;suzhen&quot;</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object size should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;300&quot;</span> <span class="k">end</span>
</span><span class='line'>          <span class="n">it</span> <span class="s2">&quot;Volume object owner should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="s2">&quot;sue&quot;</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object iscsi_portal should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">iscsi_portal</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object iscsi_target should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">iscsi_target</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object date_created should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">date_created</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object date_modified should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">date_modified</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object type should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;to json should &quot;</span> <span class="k">do</span>
</span><span class='line'>       <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="vi">@v</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;suzhen&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;owner&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;sue&quot;</span><span class="p">,</span> <span class="s2">&quot;date_created&quot;</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="s2">&quot;date_modified&quot;</span><span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="s2">&quot;iscsi_target&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;iscsi_portal&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;&quot;</span><span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;none arguments&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
</span><span class='line'>        <span class="vi">@v</span> <span class="o">=</span> <span class="no">Volume</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object name should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">nil</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object size should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">nil</span> <span class="k">end</span>
</span><span class='line'>          <span class="n">it</span> <span class="s2">&quot;Volume object owner should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="kp">nil</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object iscsi_portal should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">iscsi_portal</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">nil</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object iscsi_target should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">iscsi_target</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">nil</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object date_created should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">date_created</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object date_modified should nil&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">date_modified</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;Volume object type should has value&quot;</span> <span class="k">do</span> <span class="vi">@v</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">end</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;to_json should &quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="vi">@v</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;owner&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;date_created&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2013-02-02 00:00:00 +0800&quot;</span><span class="p">,</span> <span class="s2">&quot;date_modified&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2013-02-02 00:00:00 +0800&quot;</span><span class="p">,</span> <span class="s2">&quot;iscsi_target&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;iscsi_portal&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  1，看到一长串的实例变量名称，会把这些名称放进一个array里，并且把这个array冻结起来，不能随意增加或者减少了。然后再遍历这个array,生成读写方法。</p>

<p>  注释掉这句 # attr_accessor :name, :size, :type, :owner, :date_created, :date_modified, :iscsi_target, :iscsi_portal</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="no">ATTRIBUTES</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>      <span class="ss">:name</span><span class="p">,</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">:type</span><span class="p">,</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">:date_created</span><span class="p">,</span> <span class="ss">:date_modified</span><span class="p">,</span><span class="ss">:iscsi_target</span><span class="p">,</span><span class="ss">:iscsi_portal</span>
</span><span class='line'>    <span class="o">].</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="kp">attr</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>test通过。
</code></pre>

<p>   还可以再简单一点</p>

<p>  注释掉
  ＃ ATTRIBUTES.each do |attr|</p>

<pre><code>＃  attr_accessor attr
</code></pre>

<p>   ＃ end</p>

<p>  改为：</p>

<p>   attr_accessor *ATTRIBUTES</p>

<p>   test通过。</p>

<p>  2 修改initialize方法，因为有了之前的ATTRIBUTES数组，这里就可以不用一个个写方法赋值了。</p>

<p>  注释掉原来的initialize方法</p>

<p>  ＃def initialize(args={})</p>

<pre><code>＃    @name = args[:name]
</code></pre>

<p>   ＃     @size = args[:size]</p>

<pre><code>＃    @type = args[:type].nil? ? SYSTEM :  args[:type]
＃    @owner = args[:owner]
＃    @iscsi_target = args[:iscsi_target]
 ＃   @iscsi_portal = args[:iscsi_portal]
＃    @date_created = Time.new(2013,2,2)
 ＃   @date_modified = Time.new(2013,2,2)
</code></pre>

<p>   ＃ end</p>

<p>  改为：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>    <span class="no">DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">SYSTEM</span>
</span><span class='line'>      <span class="p">}</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="p">?</span> <span class="no">DEFAULTS</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">:</span> <span class="no">DEFAULTS</span>
</span><span class='line'>        <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">key?</span><span class="p">(</span><span class="kp">attr</span><span class="p">))</span>
</span><span class='line'>            <span class="nb">instance_variable_set</span><span class="p">(</span><span class="s2">&quot;@</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">[</span><span class="kp">attr</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="vi">@date_created</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>           <span class="vi">@date_modified</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>   <span class="nb">test</span><span class="err">通过。</span>
</span><span class='line'>
</span><span class='line'>        <span class="mi">3</span> <span class="err">修改</span><span class="nb">inspect</span><span class="err">方法</span>
</span><span class='line'>
</span><span class='line'>   <span class="err">＃</span><span class="k">def</span> <span class="nf">inspect</span>
</span><span class='line'>     <span class="err">＃</span>   <span class="k">return</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="vi">@name</span><span class="p">,</span>
</span><span class='line'>    <span class="err">＃</span>            <span class="ss">:size</span> <span class="o">=&gt;</span> <span class="vi">@size</span><span class="p">,</span>
</span><span class='line'>      <span class="err">＃</span>          <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="vi">@type</span><span class="p">,</span>
</span><span class='line'>      <span class="err">＃</span>          <span class="ss">:owner</span> <span class="o">=&gt;</span> <span class="vi">@owner</span><span class="p">,</span>
</span><span class='line'>      <span class="err">＃</span>          <span class="ss">:date_created</span> <span class="o">=&gt;</span> <span class="vi">@date_created</span><span class="p">,</span>
</span><span class='line'>      <span class="err">＃</span>          <span class="ss">:date_modified</span> <span class="o">=&gt;</span> <span class="vi">@date_modified</span><span class="p">,</span>
</span><span class='line'>       <span class="err">＃</span>         <span class="ss">:iscsi_target</span> <span class="o">=&gt;</span> <span class="vi">@iscsi_target</span><span class="p">,</span>
</span><span class='line'>       <span class="err">＃</span>         <span class="ss">:iscsi_portal</span> <span class="o">=&gt;</span> <span class="vi">@iscsi_portal</span> <span class="p">}</span>
</span><span class='line'>     <span class="err">＃</span> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">inspect</span>
</span><span class='line'>        <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">inject</span><span class="p">({</span> <span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>          <span class="n">h</span><span class="o">[</span><span class="kp">attr</span><span class="o">]</span> <span class="o">=</span> <span class="nb">instance_variable_get</span><span class="p">(</span><span class="s2">&quot;@</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">h</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>   test通过。</p>

<p>  可以把inspect的效果写的更绚一点</p>

<p>  Hash[ *ATTRIBUTES.map { |attr| [ attr, instance_variable_get(&#8220;@#{attr}&#8221;) ] }.flatten ]</p>

<p>   test通过。</p>

<p>  4 如果我们觉得用initialize传入option这种方式太土，可以用一种更COOL的方式。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>       <span class="err">＃第一步先初始化默认值</span>
</span><span class='line'>        <span class="no">ATTRIBUTES</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="kp">attr</span><span class="o">|</span>
</span><span class='line'>          <span class="nb">self</span><span class="o">.</span><span class="n">__send__</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">,</span> <span class="no">DEFAULTS</span><span class="o">[</span><span class="kp">attr</span><span class="o">]</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>          <span class="err">＃通过</span><span class="n">attr_access</span> <span class="err">定义的读写方法来赋值</span>
</span><span class='line'>        <span class="k">yield</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">block_given?</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  那么初始化方式为：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="vi">@v</span> <span class="o">=</span> <span class="no">Volume</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span><span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;suzhen&quot;</span><span class="p">;</span> <span class="n">v</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;300&quot;</span><span class="p">;</span><span class="n">v</span><span class="o">.</span><span class="n">owner</span><span class="o">=</span><span class="s2">&quot;sue&quot;</span><span class="p">;</span><span class="n">v</span><span class="o">.</span><span class="n">iscsi_target</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="n">v</span><span class="o">.</span><span class="n">iscsi_portal</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="n">v</span><span class="o">.</span><span class="n">date_created</span><span class="o">=</span><span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="n">v</span><span class="o">.</span><span class="n">date_modified</span><span class="o">=</span><span class="no">Time</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/rubyji-cheng-initializeshi-de-shun-xu/">RUBY继承initialize时的顺序</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T10:52:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>RUBY继承initialize时的顺序</p>

<p>我们分析一下有几种继承情况：</p>

<p>1、一个子类继承一个父类。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Parent</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">family_name</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">family_name</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;parent&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Son</span> <span class="o">&lt;</span> <span class="no">Parent</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  子类和父类都有initialize方法，子类的会覆盖父类的同名方法，父类的initalize方法不会被执行。</p>

<p>  Son.new #->  son</p>

<p>  如果子类打算调用父类的initalize方法，就必须使用super明显的调用:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Son</span> <span class="o">&lt;</span> <span class="no">Parent</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">(</span><span class="s2">&quot;sue&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Son</span><span class="o">.</span><span class="n">new</span> <span class="c1">#-&gt;  sue parent son</span>
</span></code></pre></td></tr></table></div></figure>


<p>2、一个类include一个module。</p>

<p>  这种方式其实就是在让class继承一个“代理类”。这个“代理类”就是module生成的。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;skill&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Son</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  class和module都有initialize方法，class会覆盖module的同名方法，module的initalize方法不会被执行。</p>

<p>  Son.new #->  son</p>

<p>  如果class打算调用module的initalize方法，就必须使用super明显的调用:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Son</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Son</span><span class="o">.</span><span class="n">new</span> <span class="c1">#-&gt;  skill son</span>
</span></code></pre></td></tr></table></div></figure>


<p>3、一个类include多个module.</p>

<p>  一个class能include多个module,这是Matz在解决类多继承的一个方式。我们要理解这种继承方式，class能继承多类，但是一层一层的继承，继承是有顺序的，是线性的，不是菱型的。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;skill&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Interest</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;interest&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Son</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Skill</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Interest</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Son类include两个module的顺序就非常的重要，这会影响到module的“代理类”在继承线上顺序的。这个例子中 可以认为是son类继承了interest代理类，interest代理类继承了skill代理类。   Son&lt;Interest&lt;Skill</p>

<p>  同理：同名方法会被覆盖。super的调用只会调用父类，如果要调用祖父类的同名方法，就要在父类的同名方法中使用super。super只针对父类的同名方法，不能跨级调用。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;skill&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Interest</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;interest&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Son</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Skill</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Interest</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Son</span><span class="o">.</span><span class="n">new</span> <span class="c1">#-&gt;  skill interest son</span>
</span></code></pre></td></tr></table></div></figure>


<p>4、一个类即继承一个父类，又包含若干个module</p>

<p>  分析这个情况，要明白：“代理类”要比真正要继承的类，更先被继承。在继承线上更靠前。根据以上的学习我们会很快写出结果：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">Skill</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">(</span><span class="s2">&quot;sue&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;skill&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Interest</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;interest&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Parent</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">family_name</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">family_name</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;parent&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Son</span> <span class="o">&lt;</span> <span class="no">Parent</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Skill</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Interest</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="k">super</span><span class="p">()</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;son&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Son</span><span class="o">.</span><span class="n">new</span> <span class="c1">#-&gt; sue parent skill interest son</span>
</span></code></pre></td></tr></table></div></figure>


<p>  牢记：super() 一定要(),不然会有问题！！！</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/06/shen-qi-de-hash/">神奇的HASH</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/06/rubymo-fa-shi-tao-xin-pian/">RUBY魔法师(掏心篇)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/06/rubydong-tai-diao-yong-fang-fa/">RUBY动态调用方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/06/javascriptgao-jie-zhi-arguments/">Javascript高阶之arguments</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/06/activemodelyu-activerecrodde-xuan-ze/">ActiveModel与ActiveRecrod的选择</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - suzhen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
